{% extends 'base.html' %}
{% load static %}

    <!-- Content -->
{% block content %}

{% if user.is_authenticated %}

{% if returnsorder|length == 0 %}
<div class="container-fluid">
   <div class="row">                  
      <div class="col-lg-12">
         <div class="card card-block card-stretch card-height print rounded">
            <div class="card-header d-flex justify-content-between bg-primary header-invoice">
               <div style="display: flex; align-items: center;">
                  <img style="height: 40px; width: 40px; margin-right: 10px;" src="{% static 'images/layouts/logo_bg.png' %}" class="img-fluid rounded-normal light-logo" alt="logo">
                  <h5>SMC/SLT</h5>
              </div>
              <button class="btn btn-primary-dark" onclick="printInvoice('{{ eventdetails.event_code }}')">
               <i class="las la-file-download"></i>Download PDF
           </button>
           
            </div>
            <div class="card-body">
                  <div class="row">
                     <div class="col-lg-12">
                        <div class="table-responsive-sm">
                              <table class="table">
                                 <thead>
                                    <tr>
                                          <th scope="col">Event Code</th>
                                          <th scope="col">Event Name</th>
                                          <th scope="col">Leader Name</th>
                                          <th scope="col">Warehouse Leader</th>
                                          <th scope="col">Start Date</th>
                                          <th scope="col">End Date</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr>
                                          <td>{{eventdetails.event_code}}</td>
                                          <td>{{eventdetails.event_name}}</td>
                                          <td>{{eventdetails.leader_name}}</td>
                                          <td>{{eventdetails.wh_leader}}</td>
                                          <td>{{eventdetails.start_date}}</td>
                                          <td>{{eventdetails.end_date}}</td>
                                    </tr>
                                 </tbody>
                              </table>
                        </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class="col-sm-12">
                        <h5 class="mb-3">Order Summary</h5>
                        <h6 class="mb-3 text-center"><b>Event Devices</b></h6>
                        <div class="table-responsive-sm">
                              <table class="table">
                                 <thead>
                                    <tr>
                                          <th class="text-center" scope="col">#</th>
                                          <th scope="col">Item</th>
                                          <th class="text-center" scope="col">Quantity</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                   {% for order, n in eventorders %}
                                    <tr>
                                          <th class="text-center" scope="row">&#8226</th>
                                          <td>
                                             <h6 class="mb-0">{{order}}</h6>
                                          </td>
                                          <td class="text-center">{{n}}</td>
                                    </tr>
                                    {% endfor %}
                                 </tbody>
                              </table>
                        </div>
                     </div>                              
                  </div>
            </div>
         </div>
      </div>                                    
   </div>
</div>
{% else %}
<div class="container-fluid">
    <div class="row">                  
       <div class="col-lg-12">
          <div class="card card-block card-stretch card-height print rounded">
             <div class="card-header d-flex justify-content-between bg-primary header-invoice">
               <div style="display: flex; align-items: center;">
                  <img style="height: 40px; width: 40px; margin-right: 10px;" src="{% static 'images/layouts/logo_bg.png' %}" class="img-fluid rounded-normal light-logo" alt="logo">
                  <h5>SMC/SLT</h5>
              </div>
              <button class="btn btn-primary-dark" onclick="printInvoice('{{ eventdetails.event_code }}')">
               <i class="las la-file-download"></i>Download PDF
           </button>

           
           
             </div>
             <div class="card-body">
                   <div class="row">
                      <div class="col-lg-12">
                         <div class="table-responsive-sm">
                               <table class="table">
                                  <thead>
                                     <tr>
                                           <th scope="col">Event Code</th>
                                           <th scope="col">Event Name</th>
                                           <th scope="col">Leader Name</th>
                                           <th scope="col">Warehouse Leader</th>
                                           <th scope="col">Start Date</th>
                                           <th scope="col">End Date</th>
                                     </tr>
                                  </thead>
                                  <tbody>
                                     <tr>
                                           <td>{{eventdetails.event_code}}</td>
                                           <td>{{eventdetails.event_name}}</td>
                                           <td>{{eventdetails.leader_name}}</td>
                                           <td>{{eventdetails.wh_leader}}</td>
                                           <td>{{eventdetails.start_date}}</td>
                                           <td>{{eventdetails.end_date}}</td>
                                     </tr>
                                  </tbody>
                               </table>
                         </div>
                      </div>
                   </div>
                   <div class="row">
                      <div class="col-sm-12">
                         <h5 class="mb-3">Order Summary</h5>
                         <h6 class="mb-3 text-center"><b>Event Devices</b></h6>
                         <div class="table-responsive-sm">
                               <table class="table">
                                  <thead>
                                     <tr>
                                           <th class="text-center" scope="col">#</th>
                                           <th scope="col">Item</th>
                                           <th class="text-center" scope="col">Quantity</th>
                                           <!-- <th class="text-center" scope="col">Price</th>
                                           <th class="text-center" scope="col">Totals</th> -->
                                     </tr>
                                  </thead>
                                  <tbody>
                                    {% for order, n in eventorders %}
                                     <tr>
                                           <th class="text-center" scope="row">&#8226</th>
                                           <td>
                                              <h6 class="mb-0">{{order}}</h6>
                                              <!-- <p class="mb-0">Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                                              </p> -->
                                           </td>
                                           <td class="text-center">{{n}}</td>
                                           <!-- <td class="text-center">$120.00</td>
                                           <td class="text-center"><b>$2,880.00</b></td> -->
                                     </tr>
                                     {% endfor %}
                                     <!-- <tr>
                                           <th class="text-center" scope="row">2</th>
                                           <td>
                                              <h6 class="mb-0">Web Design</h6>
                                              <p class="mb-0">Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                                              </p>
                                           </td>
                                           <td class="text-center">5</td>
                                           <td class="text-center">$120.00</td>
                                           <td class="text-center"><b>$2,880.00</b></td>
                                     </tr>
                                     <tr>
                                           <th class="text-center" scope="row">3</th>
                                           <td>
                                              <h6 class="mb-0">Web Design</h6>
                                              <p class="mb-0">Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                                              </p>
                                           </td>
                                           <td class="text-center">5</td>
                                           <td class="text-center">$120.00</td>
                                           <td class="text-center"><b>$2,880.00</b></td>
                                     </tr>
                                     <tr>
                                           <th class="text-center" scope="row">4</th>
                                           <td>
                                              <h6 class="mb-0">Web Design</h6>
                                              <p class="mb-0">Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                                              </p>
                                           </td>
                                           <td class="text-center">5</td>
                                           <td class="text-center">$120.00</td>
                                           <td class="text-center"><b>$2,880.00</b></td>
                                     </tr> -->
                                  </tbody>
                               </table>
                         </div>
                      </div>   
                      <div class="col-sm-12">
                        <!-- <h5 class="mb-3">Order Summary</h5> -->
                        <h6 class="mb-3 text-center"><b>Return Devices</b></h6>
                        <div class="table-responsive-sm">
                              <table class="table">
                                 <thead>
                                    <tr>
                                          <th class="text-center" scope="col">#</th>
                                          <th scope="col">Item</th>
                                          <th class="text-center" scope="col">Quantity</th>
                                          <!-- <th class="text-center" scope="col">Price</th>
                                          <th class="text-center" scope="col">Totals</th> -->
                                    </tr>
                                 </thead>
                                 <tbody>
                                   {% for order, n in eventreturns %}
                                    <tr>
                                          <th class="text-center" scope="row">&#8226</th>
                                          <td>
                                             <h6 class="mb-0">{{order}}</h6>
                                          </td>
                                          <td class="text-center">{{n}}</td>
                                    </tr>
                                    {% endfor %}
                                 </tbody>
                              </table>
                        </div>
                     </div>                            
                   </div>
                   <!-- <div class="row">
                      <div class="col-sm-12">
                         <b class="text-danger">Notes:</b>
                         <p class="mb-0">It is a long established fact that a reader will be distracted by the readable content of a page
                               when looking
                               at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters,
                               as opposed to using 'Content here, content here', making it look like readable English.</p>
                      </div>
                   </div>
                   <div class="row mt-4 mb-3">
                      <div class="offset-lg-8 col-lg-4">
                         <div class="or-detail rounded">
                               <div class="p-3">
                                  <h5 class="mb-3">Order Details</h5>
                                  <div class="mb-2">
                                     <h6>Bank</h6>
                                     <p>Threadneedle St</p>
                                  </div>
                                  <div class="mb-2">
                                     <h6>Acc. No</h6>
                                     <p>12333456789</p>
                                  </div>
                                  <div class="mb-2">
                                     <h6>Due Date</h6>
                                     <p>12 August 2020</p>
                                  </div>
                                  <div class="mb-2">
                                     <h6>Sub Total</h6>
                                     <p>$4597.50</p>
                                  </div>
                                  <div>
                                     <h6>Discount</h6>
                                     <p>10%</p>
                                  </div>
                               </div>
                               <div class="ttl-amt py-2 px-3 d-flex justify-content-between align-items-center">
                                  <h6>Total</h6>
                                  <h3 class="text-primary font-weight-700">$4137.75</h3>
                               </div>
                         </div>
                      </div>
                   </div>                             -->
             </div>
          </div>
       </div>                                    
    </div>
 </div>
{% endif %}

{% else %}

<div class="position-relative text-center">
    <img src="{% static 'images/error/login_first.jpg' %}" 
         class="img-fluid w-100 vh-100" 
         alt="Access Denied"
         style="object-fit: cover;">

    <a href="{% url 'login' %}" 
       class="btn position-absolute" 
       style="bottom: 200px; right: 260px; font-size: 18px; padding: 12px 24px; background-color: #FFD000; color: #0c1559;">
       LOG IN
    </a>
</div>

{% endif %}

<script>
   function printInvoice(eventCode) {
       // Create a hidden iframe
       let iframe = document.createElement('iframe');
       iframe.style.display = 'none';
       iframe.src = `/print-invoice/${eventCode}/`;  // Your URL to printable view

       // Append the iframe to the document body
       document.body.appendChild(iframe);

       iframe.onload = function () {
           // Ensure the iframe content is loaded before printing
           iframe.contentWindow.focus();
           iframe.contentWindow.print();

           // Cleanup: Remove the iframe after printing
           setTimeout(() => {
               document.body.removeChild(iframe);
           }, 1000); // Delay to ensure the print dialog is shown
       };
   }
</script>
   

{% endblock content %}
    <!-- End Content -->